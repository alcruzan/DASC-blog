---
title: "San Francisco"
date: 2015-01-01T13:09:13-06:00
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(dplyr)
library(stringr)
library(tidyverse)
library(here)
library(patchwork)
```

Using the sf_trees.csv dataset from Tidy Tuesday, I investigate what the trees
are like in San Francisco. The data has 192,987 observations and 12 variables. 
The variables are the ID given to the tree, the legal status of the tree, the 
species of the tree, the street address, the order of the trees in the case that 
there are multiple trees at one location, where the tree is on the lot, the 
primary caretaker of the tree, the date it was planted, the diameter of the tree, 
the dimension of the plot, the latitude the plant is at, and the longitude the 
tree is planted.

```{r}
sf <- read.csv(here("tidytuesday-master", "data", "2020", "2020-01-28", "sf_trees.csv"))
```

```{r}
ggplot(sf, aes(x = longitude, y = latitude, color = caretaker)) +
  geom_point(size = 0.001, alpha = 0.2) +
  xlim(-122.36,-122.525) + 
  ylim(37.7,37.82) +
  theme(legend.position = "none") +
  xlab("Longitude") +
  ylab("Latitude") +
  ggtitle("Map of the Trees in San Francisco")
```

```{r}

species_list <- sf %>%
  mutate(species = word(species, 1, sep=" ")) %>%
  separate_rows(species, sep = ' ') %>%
  group_by(species) %>%
  summarize(Count = n()) %>%
  filter(Count >= 5000)

x <- 0

for (i in 1:12) {
  x <- x + species_list[i,2]
}

z <- 19287 - x

species_list[nrow(species_list) + 1,] = c("Other", z)

ggplot(species_list, aes(x= "", y=Count, fill = species)) +
  geom_bar(width = 10, stat = "identity") +
  coord_polar("y", start = 0) +
  xlab(" ") +
  ylab(" ") +
  ggtitle("Number of Trees of a Certain Species")

```

```{r}
g1 <- ggplot(sf, aes(x= site_info)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90)) +
  xlab("Tree Location") +
  ylab("Number of Trees") +
  ggtitle("Popular Locations of Trees in San Francisco")

g2 <- ggplot(sf, aes(x= site_info)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90)) + 
  ylim(0,12500) +
  xlab("Tree Location") +
  ylab("Number of Trees") +
  ggtitle("Popular Locations of Trees in San Francisco (excluding sidewalk :curbside : cutout")

g1 
  g2

```

```{r}
today <- 2020

tree_age <- sf %>%
  filter(!is.na(dbh)) %>%
  mutate(age = substr(date, 1,4)) %>%
  mutate(age = as.numeric(age)) %>%
  mutate(age = today - age) 


ggplot(tree_age, aes(x= site_info, y = dbh, size = age)) +
  geom_point(position = "jitter", alpha = 0.05) +
  facet_wrap(~cut_number(tree_age$dbh, 2)) +
  theme(axis.text.x = element_text(angle = 90)) +
  ylim(0,120)  

```

